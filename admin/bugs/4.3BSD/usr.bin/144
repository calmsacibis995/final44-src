From elsie!ado@ncifcrf.gov  Mon Apr 18 11:00:13 1988
Date: Mon, 18 Apr 88 13:12:30 EDT
From: elsie!ado@ncifcrf.gov (Arthur David Olson)
Subject: MORE/bsd 4.3 /usr/lib/calendar foils egrep on Fridays late in the year
#Index: usr.bin/calendar/calendar.c MORE/bsd 4.3 Fix
Index: usr.bin/calendar/calendar.c 4.3BSD

Description:
	The "egrep" scripts generated by "/usr/lib/calendar" are rejected
	by "egrep" on Fridays late in the year.

Repeat-By:
	Run the commands
		date 8611281200
		/usr/lib/calendar > /tmp/try
		egrep -f /tmp/try < /dev/null
	and note the result:
		egrep: regular expression too long

Fix:
	Here are context differences between the version of "calendar.c"
	distributed with MORE/bsd 4.3 and a version that produces a
	different regular expression that egrep can handle.  The different
	regular expression does not accept "011" as a synonym for "November"
	but does still accept "01" (. . ."09") as a synonym for "January"
	(. . ."September").

*** old/calendar.c	Sun Nov 30 19:08:44 1986
--- new/calendar.c	Sat Nov 29 10:42:20 1986
***************
*** 1,3 ****
--- 1,8 ----
+ #ifndef ASWAS
+ #ifdef OBJECTID
+ static char	elsieid[] = "@(#)calendar.c	3.2";
+ #endif /* OBJECTID */
+ #endif /* !ASWAS */
  static	char *sccsid = "@(#)calendar.c	4.5 (Berkeley) 84/05/07";
  /* /usr/lib/calendar produces an egrep -f file
     that will select today's and tomorrow's
***************
*** 30,35 ****
--- 35,51 ----
  {
  	struct tm *tm;
  	tm = localtime(&t);
+ #ifndef ASWAS
+ 	/*
+ 	** Prevent "egrep: regular expression too long" error.
+ 	*/
+ 	if ((tm->tm_mon + 1) >= 10)
+ 		(void) printf(
+ "(^|[ 	(,;])((%s[^ \t]*[ \t]*|%d/)0*%d)([^0123456789]|$)\n",
+ 		month[tm->tm_mon],
+ 		tm->tm_mon + 1, tm->tm_mday);
+ 	else
+ #endif /* !ASWAS */
  	printf("(^|[ 	(,;])((%s[^ \t]*[ \t]*|(0%d|%d)/)0*%d)([^0123456789]|$)\n",
  		month[tm->tm_mon],
  		tm->tm_mon + 1, tm->tm_mon + 1, tm->tm_mday);

