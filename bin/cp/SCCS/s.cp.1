h61267
s 00001/00001/00184
d D 8.3 94/04/18 07:11:17 bostic 27 26
c typo
e
s 00048/00019/00137
d D 8.2 94/04/01 10:17:37 bostic 26 25
c POSIX 1003.2B/D9 symbolic links
c make cp use err/warn, and pass errors back to the calling routine
c clean up fts_read() usage, fix errno calls
c make file-copy failed error clean up after itself immediately
e
s 00002/00002/00154
d D 8.1 93/05/31 14:18:34 bostic 25 24
c 4.4BSD snapshot (revision 8.1); add 1993 to copyright
e
s 00003/00003/00153
d D 6.22 93/05/31 13:48:49 mckusick 24 23
c minor nits 
e
s 00002/00002/00154
d D 6.21 92/07/27 13:46:32 bostic 23 22
c on second thought, make it symlink(7)
e
s 00001/00000/00155
d D 6.20 92/07/27 13:39:30 bostic 22 21
c add symlin(1)
e
s 00001/00001/00154
d D 6.19 92/06/28 14:56:18 bostic 21 20
c -p option should preserve file flags as well
e
s 00008/00000/00147
d D 6.18 92/06/05 15:52:45 elan 20 19
c Added clarification about second synopsis form.
e
s 00012/00003/00135
d D 6.17 92/06/02 13:24:36 elan 19 18
c Documented changes to command line symbolic link handling.
e
s 00011/00008/00127
d D 6.16 92/06/01 10:58:49 elan 18 17
c Added -Hh documentation.
e
s 00007/00005/00128
d D 6.15 91/07/30 17:59:05 cael 17 16
c add .St -p1003.2
e
s 00003/00001/00130
d D 6.14 91/06/27 17:15:58 bostic 16 15
c add POSIX/IEEE contribution notice
e
s 00001/00002/00130
d D 6.13 91/06/17 14:40:23 bostic 15 14
c no need to reference csh(1)
e
s 00020/00019/00112
d D 6.12 91/03/14 01:41:16 cael 14 13
c updated to -mdoc version 3
e
s 00054/00049/00077
d D 6.11 90/07/24 22:42:55 cael 13 12
c .Xr botch fix
e
s 00039/00038/00087
d D 6.10 90/06/29 16:40:58 bostic 12 11
c make consistent with POSIX 1003.2, draft 10.  Now have two recursive
c flags, -r and -R; -r is unchanged and deprecated; -R is recursive done right.
c Add ability to do FIFO's in recursive copies.  Disallow any setuid/gid bits
c if either owner or group has changed.
e
s 00076/00069/00049
d D 6.9 90/06/11 05:54:59 cael 11 10
c converted man page
e
s 00001/00011/00117
d D 6.8 90/05/31 20:28:48 bostic 10 9
c new copyright notice
e
s 00021/00007/00107
d D 6.7 89/09/11 18:10:47 bostic 9 8
c revise copying setuid files
e
s 00012/00003/00102
d D 6.6 89/09/10 12:19:16 bostic 8 7
c fixes for copying setuid files
e
s 00014/00008/00091
d D 6.5 89/08/13 13:18:17 bostic 7 6
c fix umask manipulation (make it like old cp) -- a little tricky.
c created directories are same as source, created files are source - umask.
c don't use st_ino to store directory DNE flag; use fchmod/fchown if possible
c some minor reorganization and whacks
e
s 00084/00059/00015
d D 6.4 89/05/19 18:11:47 bostic 6 5
c POSIX.2 compliance: set uid/gid for -p, add -f.
c on -r, recreate special files
e
s 00017/00008/00057
d D 6.3 89/05/08 21:27:04 bostic 5 4
c don't follow symlinks on -r; add -h flag to force symlink follow
e
s 00013/00010/00052
d D 6.2 85/06/08 02:34:03 lepreau 4 3
c add -p flag and correct sutf concerning umask
e
s 00001/00001/00061
d D 6.1 85/04/29 14:20:36 mckusick 3 2
c 4.3BSD beta release manual page
e
s 00012/00001/00050
d D 5.1 85/04/29 14:20:27 mckusick 2 1
c manual page distributed with 4.2BSD
e
s 00051/00000/00000
d D 4.1 85/04/29 14:20:20 mckusick 1 0
c manual page distributed with 4.1BSD
e
u
U
t
T
I 1
D 6
.\" Copyright (c) 1980 Regents of the University of California.
.\" All rights reserved.  The Berkeley software License Agreement
.\" specifies the terms and conditions for redistribution.
E 6
I 6
D 11
.\" Copyright (c) 1989 The Regents of the University of California.
E 11
I 11
D 25
.\" Copyright (c) 1989, 1990 The Regents of the University of California.
E 11
.\" All rights reserved.
E 25
I 25
D 26
.\" Copyright (c) 1989, 1990, 1993
E 26
I 26
.\" Copyright (c) 1989, 1990, 1993, 1994
E 26
.\"	The Regents of the University of California.  All rights reserved.
E 25
E 6
.\"
I 14
D 16
.\"     @(#)cp.1	6.11 (Berkeley) 7/24/90
E 16
I 16
.\" This code is derived from software contributed to Berkeley by
.\" the Institute of Electrical and Electronics Engineers, Inc.
.\"
E 16
E 14
I 6
D 10
.\" Redistribution and use in source and binary forms are permitted
.\" provided that the above copyright notice and this paragraph are
.\" duplicated in all such forms and that any documentation,
.\" advertising materials, and other materials related to such
.\" distribution and use acknowledge that the software was developed
.\" by the University of California, Berkeley.  The name of the
.\" University may not be used to endorse or promote products derived
.\" from this software without specific prior written permission.
.\" THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED
.\" WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
E 10
I 10
D 17
.\" %sccs.include.redist.man%
E 17
I 17
.\" %sccs.include.redist.roff%
E 17
E 10
.\"
E 6
D 11
.\"	%W% (Berkeley) %G%
E 11
I 11
D 17
.\"     %W% (Berkeley) %G%
E 17
I 17
.\"	%W% (Berkeley) %G%
E 17
E 11
.\"
D 2
.TH CP 1 
E 2
I 2
D 3
.TH CP 1 "1 April 1982"
E 3
I 3
D 11
.TH CP 1 "%Q%"
E 3
E 2
.UC 4
.SH NAME
D 6
cp \- copy
E 6
I 6
cp - copy files
E 6
.SH SYNOPSIS
D 6
.B cp
[
D 4
.B \-i
I 2
] [
.B \-r
E 4
I 4
D 5
.B \-ip
E 5
I 5
.B \-hip
E 5
E 4
E 2
] file1 file2
.PP
.B cp
[
D 4
.B \-i
I 2
] [
.B \-r
E 4
I 4
D 5
.B \-ipr
E 5
I 5
.B \-hipr
E 5
E 4
E 2
] file ... directory
E 6
I 6
\fBcp [ \fI-fhip\fB ] source_file target_file
.sp
\fBcp [ \fI-fhipr\fB ] source_file ... target_directory
.ft R
E 6
.SH DESCRIPTION
D 6
.I File1
is copied onto
.IR file2 .
D 4
The mode and owner of  
E 4
I 4
By default, the mode and owner of  
E 4
.I file2
are preserved if it already
D 4
existed; the mode of the source file
is used otherwise.
E 4
I 4
existed; otherwise the mode of the source file modified by the current
.IR umask (2)
is used.  The
.B \-p
option causes
E 6
I 6
The
E 6
.I cp
D 6
to attempt to preserve (duplicate) in its copies the modification
times and modes of the source files, ignoring the present
.IR umask .
E 6
I 6
utility copies
.I source_file
to
.I target_file
or, in the second form, one or more
.IR source_file s
are copied into the target
.IR target_directory ,
retaining their original filenames.
E 11
I 11
.Dd %Q%
.Dt CP 1
.Os BSD 4
.Sh NAME
.Nm cp
.Nd copy files
.Sh SYNOPSIS
.Nm cp
D 13
.Op Fl fhip
E 13
I 13
D 18
.Op Fl Rfhip
E 18
I 18
D 26
.Op Fl HRfhip
E 26
I 26
.Oo
.Fl R
.Op Fl H | Fl L | Fl P
.Oc
.Op Fl fip
E 26
E 18
E 13
.Ar source_file target_file
D 13
.br
E 13
.Nm cp
D 12
.Op Fl fhipr
E 12
I 12
D 18
.Op Fl Rfhip
E 18
I 18
D 26
.Op Fl HRfhip
E 26
I 26
.Oo
.Fl R
.Op Fl H | Fl L | Fl P
.Oc
.Op Fl fip
E 26
E 18
E 12
.Ar source_file ... target_directory
.Sh DESCRIPTION
D 13
In the first synopsis form,
E 13
I 13
In the first synopsis form, the
E 13
.Nm cp
utility copies the contents of the
.Ar source_file
to the
D 13
.Ar target_file
or, in the second synopsis form,
E 13
I 13
.Ar target_file .
In the second synopsis form,
E 13
the contents of each named
D 13
.Ar source_file(s)
E 13
I 13
.Ar source_file
E 13
is copied to the destination
.Ar target_directory .
The names of the files themselves are not changed.
E 11
If
D 11
.I cp
E 11
I 11
.Nm cp
E 11
D 7
detects an attempt to copy a file to itself, the copy shall fail.
E 7
I 7
detects an attempt to copy a file to itself, the copy will fail.
I 13
.Pp
E 13
D 11
.PP
E 7
For each destination file that already exists, its contents are
overwritten if permissions allow, but its mode, user ID, and group
ID are unchanged.
D 8
Otherwise, the mode of the
.I source_file
is used as modified by the file mode creation mask.
E 8
I 8
.PP
If the destination file does not exist, the mode of the source file is
D 9
used as modified by the file mode creation mask.
However, if the source file has its set user ID bit on, that bit is
removed unless both the source file and the destination file are owned
by the same user.
E 9
I 9
used as modified by the file mode creation mask (umask).
If the source file has its set user ID bit on, that bit is removed
unless both the source file and the destination file are owned by the
same user.
E 9
If the source file has its set group ID bit on, that bit is removed
unless both the source file and the destination file are in the same
group and the user is a member of that group.
I 9
If both the set user ID and set group ID bits are set, all of the above
conditions must be fulfilled or both bits are removed.
.PP
E 9
E 8
Appropriate permissions are required for file creation or overwriting.
E 6
E 4
.PP
E 11
D 6
In the second form, one or more
.I files
are copied into the
.I directory
with their original file-names.
.PP
.I Cp
refuses to copy a file onto itself.
.PP
If the 
.B \-i
option is specified, 
E 6
I 6
The following options are available:
I 13
D 14
.Tw Ds
.Tp Fl f
E 14
I 14
D 17
.Bl -tag -width 4n
E 17
I 17
.Bl -tag -width flag
I 18
.It Fl H
D 26
When encountering a symbolic link on the command line, follow it.  All other
symbolic links encountered in the traversal are not followed.
I 19
Provided for the
E 26
I 26
If the
E 26
.Fl R
D 26
option which does not follow symbolic links by default.
E 26
I 26
option is specified, symbolic links on the command line are followed.
(Symbolic links encountered in the tree traversal are not followed.)
.It Fl L
If the
.Fl R
option is specified, all symbolic links are followed.
.It Fl P
If the
.Fl R
option is specified, no symbolic links are followed.
E 26
E 19
E 18
E 17
.It Fl R
If
.Ar source_file
designates a directory,
.Nm cp
copies the directory and the entire subtree connected at that point.
This option also causes symbolic links to be copied, rather than
indirected through, and for
.Nm cp
to create special files rather than copying them as normal files.
Created directories have the same mode as the corresponding source
directory, unmodified by the process' umask.
.It Fl f
E 14
For each existing destination pathname, remove it and
create a new file, without prompting for confirmation
regardless of its permissions.
(The
.Fl i
option is ignored if the
.Fl f
option is specified.)
E 13
D 11
.TP
.I -h
E 11
I 11
D 14
.Tp Fl h
E 14
I 14
D 26
.It Fl h
E 14
E 11
D 18
Forces
E 6
D 11
.I cp
E 11
I 11
.Nm cp
E 11
D 5
will prompt the user with the name of the file
whenever the copy will cause an old file to be
overwritten. An answer of 'y' will cause 
E 5
I 5
D 6
will prompt the user with the name of the file whenever the copy
will cause an old file to be overwritten.
An answer of 'y' will cause 
E 6
I 6
to follow symbolic links.
E 18
I 18
When encountering a symbolic link anywhere in the traversal, follow it.
E 18
I 7
Provided for the
D 11
.I -r
E 11
I 11
D 12
.Fl r
E 12
I 12
.Fl R
E 12
E 11
option which does not follow symbolic links by default.
E 26
E 7
D 11
.TP
.I -f
E 11
I 11
D 13
.Tp Fl f
E 11
D 7
Force existing destination pathnames to be removed before copying,
E 7
I 7
D 12
Force existing destination pathnames to be truncated before copying,
E 7
without prompting for confirmation.
I 7
(The
E 12
I 12
Turns off the
E 12
D 11
.I -i
E 11
I 11
.Fl i
E 11
D 12
option is ignored if the
E 12
I 12
option.
(The last
E 12
D 11
.I -f
E 11
I 11
.Fl f
E 11
D 12
option is specified.)
E 12
I 12
or
.Fl i
option overrides any previous specification of either option.)
E 13
E 12
E 7
D 11
.TP
.I -i
E 11
I 11
D 14
.Tp Fl i
E 14
I 14
.It Fl i
E 14
E 11
Causes
E 6
E 5
D 11
.I cp
E 11
I 11
.Nm cp
E 11
D 5
to continue. Any other answer will prevent it
from overwriting the file.
E 5
I 5
D 6
to continue.
Any other answer will prevent it from overwriting the file.
E 5
I 2
.PP
If the
.B \-r
option is specified and any of the source files are directories,
E 6
I 6
D 24
to write a prompt to standard error before copying a file that would
E 24
I 24
D 26
to write a prompt to the standard error output before copying a file that would
E 24
overwrite an existing file.
E 26
I 26
to write a prompt to the standard error output before copying a file
that would overwrite an existing file.
E 26
D 13
If the response from the standard input begins with the character ``y'',
D 12
the file is copied if permissions allow the copy.
E 12
I 12
the file is copied if permissions allow.
(The last
.Fl f
or
.Fl i
option overrides any previous specification of either option.)
E 13
I 13
If the response from the standard input begins with the character
.Sq Li y ,
D 26
the file is copied if permissions allow the copy.
E 26
I 26
the file copy is attempted.
E 26
E 13
E 12
D 11
.TP
.I -p
E 11
I 11
D 14
.Tp Fl p
E 14
I 14
.It Fl p
E 14
E 11
Causes
E 6
D 11
.I cp
E 11
I 11
.Nm cp
E 11
D 6
copies each subtree rooted at that name; in this case
the destination must be a directory.
I 5
.I Cp
does not follow symbolic links if the
.B -r
option is specified.
The
.B -h
option forces
E 6
I 6
to preserve in the copy as many of the modification time, access time,
I 7
D 13
.\" and file mode as allowed by permissions.
E 13
E 7
D 21
file mode, user ID, and group ID as allowed by permissions.
E 21
I 21
file flags, file mode, user ID, and group ID as allowed by permissions.
E 21
I 8
D 9
If either the user ID or group ID are not settable for any reason,
the set user ID and set group ID bits are removed from the copy's
E 9
I 9
D 11
.IP
E 11
I 11
.Pp
E 11
If the user ID and group ID cannot be preserved, no error message
is displayed and the exit value is not altered.
D 11
.IP
E 11
I 11
.Pp
E 11
D 12
If the source file has its set user ID bit on and the user ID cannot
be preserved, the set user ID bit is not preserved
in the copy's permissions.
If the source file has its set group ID bit on and the group ID cannot
be preserved, the set group ID bit is not preserved
in the copy's permissions.
If the source file has both the set user ID and set group ID bits
on and either the user ID or group ID cannot be preserved, neither
the set user ID or set group ID bits are preserved in the copy's
E 9
permissions.
E 8
D 11
.TP
.I -r
E 11
I 11
.Tp Fl r
E 12
I 12
D 13
If the source file is set user ID or set group ID, and either the user
ID or the group ID cannot be preserved, the set user ID and set group
ID bits are not preserved in the copy's permissions.
E 13
I 13
If the source file has its set user ID bit on and the user ID cannot
be preserved, the set user ID bit is not preserved
in the copy's permissions.
If the source file has its set group ID bit on and the group ID cannot
be preserved, the set group ID bit is not preserved
in the copy's permissions.
D 24
If the source file has both the set user ID and set group ID bits
on and either the user ID or group ID cannot be preserved, neither
E 24
I 24
If the source file has both its set user ID and set group ID bits on,
and either the user ID or group ID cannot be preserved, neither
E 24
the set user ID or set group ID bits are preserved in the copy's
permissions.
E 13
D 14
.Tp Fl R
E 12
E 11
If
D 11
.I source_file
E 11
I 11
.Ar source_file
E 11
designates a directory,
E 6
D 11
.I cp
E 11
I 11
.Nm cp
E 11
D 6
to always follow symbolic links.
E 6
I 6
copies the directory and the entire subtree connected at that point.
D 12
This option also causes symbolic links to be copied, rather than
indirected through, and for
D 11
.I cp
E 11
I 11
.Nm cp
E 11
to create special files rather than copying them as normal files.
E 12
I 12
D 13
Special file types, such as symbolic links and block and character
devices, are recreated instead of being copied.
E 13
I 13
This option also causes symbolic links to be copied, rather than
indirected through, and for
.Nm cp
to create special files rather than copying them as normal files.
E 13
E 12
D 7
.PP
The
.I -i
option is ignored if the
.I -f
option is specified.
E 7
I 7
Created directories have the same mode as the corresponding source
D 9
directory, unmodified by the process' file mode creation mask.
E 9
I 9
D 12
directory, unmodified by the process' umask.
E 12
I 12
D 13
directory, unmodified by the process' file mode creation mask (umask).
.Tp Fl r
The
.Fl r
option is identical to the
.Fl R
option with the exception that it does not treat special files
differently from regular files.
Symbolic links are always followed.
This option has been deprecated.
E 13
I 13
directory, unmodified by the process' umask.
E 13
E 12
E 9
E 7
D 11
.PP
E 11
I 11
.Tp
E 14
I 14
.El
E 14
.Pp
For each destination file that already exists, its contents are
D 12
overwritten if permissions allow, but its mode, user ID, and group
ID are unchanged.
E 12
I 12
D 13
overwritten if permissions allow, but
.Nm cp
will not change its mode, user ID, or group ID.
However, if the file is not being copied by the super-user,
writing the file may clear the set user ID or set group ID
permission bits.
E 13
I 13
overwritten if permissions allow, but its mode, user ID, and group
ID are unchanged.
E 13
E 12
.Pp
I 20
In the second synopsis form, 
.Ar target_directory 
must exist unless there is only one named
.Ar source_file
which is a directory and the 
.Fl R 
flag is specified.
.Pp
E 20
If the destination file does not exist, the mode of the source file is
D 13
used as modified by the file mode creation mask (umask).
D 12
If the source file has its set user ID bit on, that bit is removed
unless both the source file and the destination file are owned by the
same user.
If the source file has its set group ID bit on, that bit is removed
unless both the source file and the destination file are in the same
group and the user is a member of that group.
If both the set user ID and set group ID bits are set, all of the above
conditions must be fulfilled or both bits are removed.
E 12
I 12
If the source file is either set user ID or set group ID, those
bits are removed unless the source file and the destination
file are owned by the same user and group.
E 13
I 13
used as modified by the file mode creation mask
D 17
.Pf \&( Ic umask ,
E 17
I 17
.Pf ( Ic umask ,
E 17
see
.Xr csh 1 ) .
If the source file has its set user ID bit on, that bit is removed
unless both the source file and the destination file are owned by the
same user.
If the source file has its set group ID bit on, that bit is removed
unless both the source file and the destination file are in the same
group and the user is a member of that group.
If both the set user ID and set group ID bits are set, all of the above
conditions must be fulfilled or both bits are removed.
E 13
E 12
.Pp
Appropriate permissions are required for file creation or overwriting.
D 12
.Pp
E 11
Symbolic links are followed unless the
D 11
.I -r
E 11
I 11
.Fl r
E 11
option is specified, in which case the link itself is copied.
E 12
D 11
.PP
.I Cp
E 11
I 11
.Pp
I 13
D 18
Symbolic links are followed unless the
.Fl R
option is specified, in which case the link itself is copied.
E 18
I 18
D 19
Symbolic links are not followed unless the
E 19
I 19
Symbolic links are always followed unless the 
.Fl R 
D 26
flag is set in which case symbolic links are not followed by default.  
However, the
E 26
I 26
flag is set, in which case symbolic links are not followed, by default.
The
E 26
E 19
.Fl H
or 
D 26
.Fl h
E 26
I 26
.Fl L
E 26
D 19
options are specified, in which case the behavior is as detailed above.
E 19
I 19
D 27
flags (in conjuction with the
E 27
I 27
flags (in conjunction with the
E 27
.Fl R
D 26
flag) cause symbolic link following as detailed above.
E 26
I 26
flag) cause symbolic links to be followed as described above.
The
.Fl H ,
.Fl L
and
.Fl P
options are ignored unless the
.Fl R
option is specified.
In addition, these options override each other and the
command's actions are determined by the last one specified.
E 26
E 19
E 18
.Pp
E 13
.Nm Cp
E 11
exits 0 on success, >0 if an error occurred.
I 26
.Sh COMPATIBILITY
Historic versions of the
.Nm cp
utility had a
.Fl r
option.
This implementation supports that option, however, its use is strongly
discouraged, as it does not correctly copy special files, symbolic links
or fifo's.
E 26
E 6
E 5
E 2
D 11
.SH "SEE ALSO"
D 4
cat(1), pr(1), mv(1)
E 4
I 4
D 5
cat(1), mv(1), rcp(1C)
E 5
I 5
D 6
cat(1), mv(1), rcp(1)
E 6
I 6
mv(1), rcp(1), umask(2)
E 11
I 11
.Sh SEE ALSO
.Xr mv 1 ,
.Xr rcp 1 ,
I 22
D 23
.Xr symlink 1 ,
E 23
E 22
D 13
.Xr umask 2
E 13
I 13
D 15
.Xr umask 2 ,
.Xr csh 1
E 15
I 15
D 19
.Xr umask 2
E 19
I 19
.Xr umask 2 , 
D 23
.Xr fts 3
E 23
I 23
.Xr fts 3 ,
.Xr symlink 7
E 23
E 19
E 15
E 13
.Sh HISTORY
The
.Nm cp
D 14
command appeared in Version 6 AT&T UNIX.
E 14
I 14
D 17
command is expected to be POSIX 1003.2 compatible.
E 17
I 17
command is expected to be
.St -p1003.2
compatible.
E 17
E 14
E 11
E 6
E 5
E 4
E 1
