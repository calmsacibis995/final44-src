h12274
s 00002/00002/00193
d D 8.3 94/04/19 07:26:58 bostic 14 13
c spell
e
s 00001/00001/00194
d D 8.2 93/12/11 22:38:02 mckusick 13 12
c copyediting for Usenix manuals
e
s 00002/00002/00193
d D 8.1 93/06/04 12:05:16 bostic 12 11
c 4.4BSD snapshot (revision 8.1); add 1993 to copyright
e
s 00001/00001/00194
d D 6.9 92/04/23 16:34:36 bostic 11 10
c sigstack -> sigaltstack
e
s 00001/00001/00194
d D 6.8 91/09/22 21:12:25 cael 10 9
c fix parens
e
s 00004/00004/00191
d D 6.7 91/07/31 19:56:21 cael 9 8
c reposition display
e
s 00167/00200/00028
d D 6.6 91/04/19 14:50:07 cael 8 7
c macro and text revision (-mdoc version 3)
e
s 00026/00020/00202
d D 6.5 90/07/01 16:37:06 karels 7 6
c updates
e
s 00001/00001/00221
d D 6.4 86/05/20 08:34:30 anne 6 5
c spelling correction
e
s 00002/00002/00220
d D 6.3 86/01/08 13:39:38 mckusick 5 4
c SIGUSR does not cause a core dump if not caught or ignored
e
s 00004/00001/00218
d D 6.2 85/11/06 12:02:52 bloom 4 3
c change return value of handler, add new signals for 4.3
e
s 00001/00001/00218
d D 6.1 85/05/09 17:51:23 mckusick 3 2
c 4.3BSD beta release manual page
e
s 00147/00128/00072
d D 5.1 85/05/09 17:50:37 mckusick 2 1
c manual page distributed with 4.2BSD
e
s 00200/00000/00000
d D 4.1 85/05/09 17:49:52 mckusick 1 0
c manual page distributed with 4.1BSD
e
u
U
t
T
I 1
D 8
.\" Copyright (c) 1980 Regents of the University of California.
.\" All rights reserved.  The Berkeley software License Agreement
.\" specifies the terms and conditions for redistribution.
E 8
I 8
D 12
.\" Copyright (c) 1980, 1991 Regents of the University of California.
.\" All rights reserved.
E 12
I 12
.\" Copyright (c) 1980, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
E 12
E 8
.\"
D 8
.\"	%W% (Berkeley) %G%
E 8
I 8
.\" %sccs.include.redist.man%
E 8
.\"
D 2
.TH SIGNAL 2 
E 2
I 2
D 3
.TH SIGNAL 3C "15 June 1983"
E 3
I 3
D 8
.TH SIGNAL 3C "%Q%"
E 3
E 2
.UC 4
I 2
.ie t .ds d \(dg
.el .ds d \z'|+'
.ie t .ds b \(bu
.el .ds b @
E 2
.SH NAME
D 2
signal \- catch or ignore signals
E 2
I 2
signal \- simplified software signal facilities
E 2
.SH SYNOPSIS
.nf
.B #include <signal.h>
.PP
D 7
.B (*signal(sig, func))()
D 4
.B void (*func)();
E 4
I 4
.B int (*func)();
E 7
I 7
.B void (*signal(sig, func))()
.B void (*func)();
E 7
E 4
.fi
.SH DESCRIPTION
D 2
.IR N.B. :
The system currently supports two signal implementations.
The one described here is standard in version 7 UNIX systems,
and is retained for backward compatabililty.
The one described in
.IR sigsys (2)
as supplemented by
.IR sigset (3)
provides for the needs of the job control mechanisms 
used by
.IR csh (1),
and corrects the bugs in this older implementation of signals,
allowing programs
which process interrupts
to be written
reliably.
E 2
I 2
.I Signal
E 8
I 8
.\"     %W% (Berkeley) %G%
.\"
.Dd %Q%
.Dt SIGNAL 3
.Os BSD 4
.Sh NAME
.Nm signal
.Nd simplified software signal facilities
.Sh SYNOPSIS
.Fd #include <signal.h>
.Ft void
I 9
D 10
.Fn *signal sig func Ns Pq
E 10
I 10
.Fn *signal sig func\*(lp\*(rp
E 10
.Ft void
E 9
.\" can not do this with .Fn yet
D 9
\*(fN*signal\*(lp\*(fAsig\fR, \*(fAfunc\*(rp\|\*(lp\|\*(rp\fR
E 9
.br
D 9
.Ft void
\*(fN*func\*(rp\*(lp\|\*(rp\fR
E 9
I 9
\*(lp\|\*(fN*func\*(rp\*(lp\|\*(rp\fR
E 9
.Sh DESCRIPTION
This
.Fn signal
facility
E 8
is a simplified interface to the more general
D 7
.IR sigvec (2)
E 7
I 7
D 8
.IR sigaction (2)
E 8
I 8
.Xr sigaction 2
E 8
E 7
facility.
E 2
D 8
.PP
A signal
is generated by some abnormal event,
D 2
initiated either by user at a terminal (quit, interrupt),
E 2
I 2
initiated by a user at a terminal (quit, interrupt, stop),
E 2
by a program error (bus error, etc.),
D 2
or by request of another program (kill).
Normally all signals
cause termination of the receiving process,
but a
E 2
I 2
by request of another program (kill),
or when a process is stopped because it wishes to access
E 8
I 8
.Pp
Signals allow the manipulation of a process from outside its
domain as well as allowing the process to manipulate itself or
copies of itself (children). There are two general types of signals:
those that cause termination of a process and those that do not.
Signals which cause termination of a program might result from
an irrecoverable error or might be the result of a user at a terminal
typing the `interrupt' character.
Signals are used when a process is stopped because it wishes to access
E 8
its control terminal while in the background (see
D 8
.IR tty (4)).
E 8
I 8
.Xr tty 4 ) .
E 8
Signals are optionally generated
when a process resumes after being stopped,
when the status of child processes changes,
or when input is ready at the control terminal.
D 8
Most signals cause termination of the receiving process if no action
E 8
I 8
Most signals result in the termination of the process receiving them
if no action
E 8
is taken; some signals instead cause the process receiving them
to be stopped, or are simply discarded if the process has not
requested otherwise.
D 8
Except for the SIGKILL and SIGSTOP
E 8
I 8
Except for the
.Dv SIGKILL
and
.Dv SIGSTOP
E 8
signals, the
E 2
D 8
.I signal
D 2
call allows them either to be ignored
E 2
I 2
call allows signals either to be ignored
E 2
or to cause an interrupt to a specified location.
D 2
Here is the list of signals with names as in
the include file.
E 2
I 2
The following is a list of all signals with
names as in the include file
.RI < signal.h >:
E 2
.LP
.nf
D 2
.ta \w'SIGMMMM 'u +\w'15*  'u
E 2
I 2
.ta \w'SIGVTALRM 'u +\w'15*  'u
E 2
SIGHUP	1	hangup
SIGINT	2	interrupt
SIGQUIT	3*	quit
D 2
SIGILL	4*	illegal instruction (not reset when caught)
SIGTRAP	5*	trace trap (not reset when caught)
E 2
I 2
SIGILL	4*	illegal instruction
SIGTRAP	5*	trace trap
E 2
D 7
SIGIOT	6*	IOT instruction
E 7
I 7
SIGABRT	6*	\fIabort\fP() call (formerly SIGIOT)
E 7
SIGEMT	7*	EMT instruction
SIGFPE	8*	floating point exception
SIGKILL	9	kill (cannot be caught or ignored)
SIGBUS	10*	bus error
SIGSEGV	11*	segmentation violation
SIGSYS	12*	bad argument to system call
SIGPIPE	13	write on a pipe with no one to read it
SIGALRM	14	alarm clock
SIGTERM	15	software termination signal
D 2
	16	unassigned
E 2
I 2
SIGURG	16\*b	urgent condition present on socket
SIGSTOP	17\*d	stop (cannot be caught or ignored)
SIGTSTP	18\*d	stop signal generated from keyboard
SIGCONT	19\*b	continue after stop
SIGCHLD	20\*b	child status has changed
SIGTTIN	21\*d	background read attempted from control terminal
SIGTTOU	22\*d	background write attempted to control terminal
SIGIO	23\*b	i/o is possible on a descriptor (see \fIfcntl\fP(2))
SIGXCPU	24	cpu time limit exceeded (see \fIsetrlimit\fP(2))
SIGXFSZ	25	file size limit exceeded (see \fIsetrlimit\fP(2))
SIGVTALRM	26	virtual time alarm (see \fIsetitimer\fP(2))
SIGPROF	27	profiling timer alarm (see \fIsetitimer\fP(2))
I 4
SIGWINCH	28\*b	Window size change
I 7
SIGINFO	29\*b	status request from keyboard
E 7
D 5
SIGUSR1	30\*b	User defined signal 1
SIGUSR2	31\*b	User defined signal 2
E 5
I 5
SIGUSR1	30	User defined signal 1
SIGUSR2	31	User defined signal 2
E 5
E 4
E 2
.fi
D 2
.IR N.B. :
There are actually more signals; see
.IR sigsys (2);
the signals listed here are those of standard version 7.
E 2
.PP
The starred signals in the list above cause a core image
if not caught or ignored.
.PP
If
.I func
is SIG_DFL, the default action
for signal
.I sig
D 2
is reinstated; this default is termination,
sometimes with a core image.
E 2
I 2
is reinstated; this default is termination
(with a core image for starred signals)
except for signals marked with \*b or \*d.
Signals marked with \*b are discarded if the action
is SIG_DFL; signals marked
with \*d cause the process to stop.
E 2
If
.I func
D 2
is SIG_IGN the signal is ignored.
Otherwise
when the signal occurs
E 2
I 2
is SIG_IGN the signal is subsequently ignored
and pending instances of the signal are discarded.
Otherwise, when the signal occurs
E 8
I 8
.Fn signal
function allows for a signal to be caught, to be ignored, or to generate
D 14
an interupt.
E 14
I 14
an interrupt.
E 14
These signals are defined in the file
.Aq Pa signal.h :
.Bl -column SIGVTALARMXX "create core imagexxx"
D 9
.It Sy "  NAME  " "	  Default Action  " "	              Description"
E 9
I 9
.It Sy "  Name  " "	  Default Action  " "	              Description"
E 9
.It Dv SIGHUP No "	terminate process" "	terminal line hangup"
.It Dv SIGINT No "	terminate process" "	interrupt program"
.It Dv SIGQUIT No "	create core image" "	quit program"
.It Dv SIGILL No "	create core image" "	illegal instruction"
.It Dv SIGTRAP No "	create core image" "	trace trap"
.It Dv SIGABRT No "	create core image" Xr 	abort 2
call (formerly
.Dv SIGIOT )
.It Dv SIGEMT No "	create core image" "	emulate instruction executed"
.It Dv SIGFPE No "	create core image" "	floating-point exception"
.It Dv SIGKILL No "	terminate process" "	kill program"
.It Dv SIGBUS No "	create core image" "	bus error"
.It Dv SIGSEGV No "	create core image" "	segmentation violation"
.It Dv SIGSYS No "	create core image" "	system call given invalid argument"
.It Dv SIGPIPE No "	terminate process" "	write on a pipe with no reader"
.It Dv SIGALRM No "	terminate process" "	real-time timer expired"
.It Dv SIGTERM No "	terminate process" "	software termination signal"
.It Dv SIGURG No "	discard signal" "	urgent condition present on socket"
.It Dv SIGSTOP No "	stop process" "	stop (cannot be caught or ignored)"
.It Dv SIGTSTP No "	stop process" "	stop signal generated from keyboard"
.It Dv SIGCONT No "	discard signal" "	continue after stop"
.It Dv SIGCHLD No "	discard signal" "	child status has changed"
.It Dv SIGTTIN No "	stop process" "	background read attempted from control terminal"
.It Dv SIGTTOU No "	stop process" "	background write attempted to control terminal"
.It Dv SIGIO No "	discard signal" Tn "	I/O"
is possible on a descriptor (see
.Xr fcntl 2 )
.It Dv SIGXCPU No "	terminate process" "	cpu time limit exceeded (see"
.Xr setrlimit 2 )
.It Dv SIGXFSZ No "	terminate process" "	file size limit exceeded (see"
.Xr setrlimit 2 )
.It Dv SIGVTALRM No "	terminate process" "	virtual time alarm (see"
.Xr setitimer 2 )
.It Dv SIGPROF No "	terminate process" "	profiling timer alarm (see"
.Xr setitimer 2 )
.It Dv SIGWINCH No "	discard signal" "	Window size change"
.It Dv SIGINFO No "	discard signal" "	status request from keyboard"
.It Dv SIGUSR1 No "	terminate process" "	User defined signal 1"
.It Dv SIGUSR2 No "	terminate process" "	User defined signal 2"
.El
.Pp
The
.Fa func
procedure allows a user to choose the action upon receipt of a signal.
To set the default action of the signal to occur as listed above,
.Fa func
should be
.Dv SIG_DFL .
A
.Dv SIG_DFL
resets the default action.
To ignore the signal
.Fa func
should be
.Dv SIG_IGN .
This will cause subsequent instances of the signal to be ignored
and pending instances to be discarded. If
.Dv SIG_IGN
is not used,
E 8
D 6
further occurences of the signal are
E 6
I 6
further occurrences of the signal are
E 6
automatically blocked and
E 2
D 8
.I func
E 8
I 8
.Fa func
E 8
D 2
will be called with the
signal number as argument.
A return from the function will
continue the process at the point it was interrupted.
E 2
I 2
is called.
E 2
D 8
.PP
D 2
Except as indicated,
a signal is reset to SIG_DFL after being caught.
Thus if it is desired to
catch every such signal,
the catching routine must
issue another
.I signal
call.
E 2
I 2
A return from the function unblocks
the handled signal and
continues the process at the point it was interrupted.
\fBUnlike previous signal facilities, the handler \fIfunc\fP
remains installed after a signal has been delivered.\fP
E 2
.PP
D 2
If, when using this (older) signal interface,
a caught signal occurs
during certain system calls, the call terminates prematurely.
E 2
I 2
If a caught signal occurs
during certain system calls, causing
the call to terminate prematurely, the call
D 7
is automatically restarted.
E 2
In particular this can occur
D 2
during an
.IR ioctl ,
.IR read ,
E 2
I 2
during a
.I read
E 2
or
.IR write (2)
D 2
on a slow device (like a terminal; but not a file);
and during
.I pause
or
E 2
I 2
on a slow device (such as a terminal; but not a file)
E 7
I 7
is automatically restarted
(the handler is installed using the SA_RESTART flag with
.IR sigaction (2)).
E 8
I 8
.Pp
The handled signal is unblocked with the
function returns and
D 14
the process continues from where it left off when the signal occured.
E 14
I 14
the process continues from where it left off when the signal occurred.
E 14
.Bf -symbolic
Unlike previous signal facilities, the handler
func() remains installed after a signal has been delivered.
.Ef
.Pp
For some system calls, if a signal is caught while the call is
D 13
executing and the call is permaturely terminated,
E 13
I 13
executing and the call is prematurely terminated,
E 13
the call is automatically restarted.
(The handler is installed using the
.Dv SA_RESTART
flag with
.Xr sigaction 2 . )
E 8
The affected system calls include
D 8
.IR read (2),
.IR write (2),
.IR sendto (2),
.IR recvfrom (2),
.IR sendmsg (2)
E 8
I 8
.Xr read 2 ,
.Xr write 2 ,
.Xr sendto 2 ,
.Xr recvfrom 2 ,
.Xr sendmsg 2
E 8
and
D 8
.IR recvmsg (2)
on a communications channel or a slow device (such as a terminal,
but not a regular file)
E 8
I 8
.Xr recvmsg 2
on a communications channel or a low speed device
E 8
E 7
and during a
E 2
D 7
.IR wait (2).
E 7
I 7
D 8
.IR wait (2)
E 8
I 8
.Xr ioctl 2
E 8
or
D 8
.IR ioctl (2).
E 8
I 8
.Xr wait 2 .
E 8
However, calls that have already committed are not restarted,
but instead return a partial success (for example, a short read count).
E 7
D 2
When such a signal occurs, the saved user status
is arranged in such a way that when return from the
signal-catching takes place, it will appear that the
system call returned an error status.
The user's program may then, if it wishes,
re-execute the call.
E 2
D 8
.PP
The value of
.I signal
is the previous (or initial)
value of
.I func
for the particular signal.
.PP
After a
D 2
.IR  fork (2)
E 2
I 2
.IR fork (2)
or
.IR vfork (2)
E 2
the child inherits
all signals.
D 2
.IR  Exec (2)
resets all
caught signals to default action.
.PP
If a process is using the mechanisms of
.IR sigsys (2)
and
.IR sigset (3)
then many of these calls are automatically restarted
(See
.IR sigsys (2)
and
.IR jobs (3)
for details).
E 2
I 2
.IR  Execve (2)
resets all caught signals to the default action;
E 8
I 8
.Pp
When a process which has installed signal handlers forks,
the child process inherits the signals.
All caught signals may be reset to their default action by a call
to the
.Xr execve 2
function;
E 8
ignored signals remain ignored.
D 8
.SH "RETURN VALUE
E 8
I 8
.Sh RETURN VALUES
E 8
The previous action is returned on a successful call.
D 8
Otherwise, \-1 is returned and 
.I errno
E 8
I 8
Otherwise, \-1 is returned and  the global variable
.Va errno
E 8
is set to indicate the error.
D 8
.SH ERRORS
.I Signal
E 8
I 8
.Sh ERRORS
.Xr Signal
E 8
will fail and no action will take place if one of the
following occur:
D 8
.TP 15
[EINVAL]
.I Sig
E 8
I 8
.Bl -tag -width [EINVAL]
.It Bq Er EINVAL
.Em Sig
E 8
is not a valid signal number.
D 8
.TP 15
[EINVAL]
An attempt is made to ignore or supply a handler for SIGKILL
or SIGSTOP.
D 7
.TP 15
[EINVAL]
An attempt is made to ignore SIGCONT (by default SIGCONT
is ignored).
E 7
E 2
.SH "SEE ALSO"
D 2
sigsys(2),
E 2
D 7
kill(1),
D 2
kill(2),
ptrace(2),
setjmp(3),
sigset(3)
.SH DIAGNOSTICS
The value (int)\-1 is returned if the
given signal is out of range.
.SH BUGS
The traps should be distinguishable by extra arguments
to the signal handler, and all hardware supplied parameters should
be made available to the signal routine.
E 2
I 2
ptrace(2), kill(2),
sigvec(2), sigblock(2), sigsetmask(2), sigpause(2),
E 7
I 7
kill(1), ptrace(2), kill(2),
sigaction(2), sigprocmask(2), sigsuspend(2),
E 7
sigstack(2), setjmp(3), tty(4)
.SH "NOTES  (VAX-11)"
The handler routine can be declared:
E 2
.PP
D 2
If a repeated signal arrives before the last one can be
reset, there is no chance to catch it
(however this is
.B not
true if you use
.IR sigsys (2)
and
.IR sigset (3)).
E 2
I 2
D 7
    handler(sig, code, scp)
E 7
I 7
    void handler(sig, code, scp)
E 7
E 2
.PP
D 2
The type specification of the routine and its
.I func
argument are problematical.
.SH "ASSEMBLER (PDP-11)"
(signal = 48.)
.br
.B sys  signal; sig; label
.br
(old label in r0)
E 2
I 2
Here
.I sig
is the signal number, into which the hardware faults and traps are
mapped as defined below.  Code is a parameter which is either a constant
as given below or, for compatibility mode faults, the code provided by
the hardware. 
.I Scp
is a pointer to the
.I "struct sigcontext"
used by the system to restore the process context from before
the signal.
Compatibility mode faults are distinguished from the
other SIGILL traps by having PSL_CM set in the psl.
E 2
.PP
D 2
If
.I label
is 0,
default action is reinstated.
If
.I label
is 1, the signal is ignored.
Any other even
.I label
specifies an address in the process
where an interrupt is simulated.
An RTI or RTT instruction will return from the
interrupt.
.SH "NOTES (VAX-11)"
See
.IR sigsys (2)
for information on how hardware faults are mapped into signals.
E 2
I 2
The following defines the mapping of hardware traps to signals
and codes.  All of these symbols are defined in
.RI < signal.h >:
.LP
.ta \w'     Floating/decimal divide by zero   'u +\w'15*  'u +8n
.nf
   Hardware condition	Signal	Code

Arithmetic traps:
   Integer overflow	SIGFPE	FPE_INTOVF_TRAP
   Integer division by zero	SIGFPE	FPE_INTDIV_TRAP
   Floating overflow trap	SIGFPE	FPE_FLTOVF_TRAP
   Floating/decimal division by zero	SIGFPE	FPE_FLTDIV_TRAP
   Floating underflow trap	SIGFPE	FPE_FLTUND_TRAP
   Decimal overflow trap	SIGFPE	FPE_DECOVF_TRAP
   Subscript-range	SIGFPE	FPE_SUBRNG_TRAP
   Floating overflow fault	SIGFPE	FPE_FLTOVF_FAULT
   Floating divide by zero fault	SIGFPE	FPE_FLTDIV_FAULT
   Floating underflow fault	SIGFPE	FPE_FLTUND_FAULT
Length access control	SIGSEGV
Protection violation	SIGBUS
Reserved instruction	SIGILL	ILL_RESAD_FAULT
Customer-reserved instr.	SIGEMT
Reserved operand	SIGILL	ILL_PRIVIN_FAULT
Reserved addressing	SIGILL	ILL_RESOP_FAULT
Trace pending	SIGTRAP
Bpt instruction	SIGTRAP
Compatibility-mode	SIGILL	hardware supplied code
Chme	SIGSEGV
Chms	SIGSEGV
Chmu	SIGSEGV
.fi
E 8
I 8
.It Bq Er EINVAL
An attempt is made to ignore or supply a handler for
.Dv SIGKILL
or
.Ev SIGSTOP .
.Sh SEE ALSO
.Xr kill 1 ,
.Xr ptrace 2 ,
.Xr kill 2 ,
.Xr sigaction 2 ,
I 11
.Xr sigaltstack 2 ,
E 11
.Xr sigprocmask 2 ,
.Xr sigsuspend 2 ,
D 11
.Xr sigstack 2 ,
E 11
.Xr setjmp 3 ,
.Xr tty 4
.Sh HISTORY
This
.Nm signal
facility appeared in 
.Bx 4.0 .
E 8
E 2
E 1
