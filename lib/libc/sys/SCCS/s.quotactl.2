h28078
s 00001/00001/00186
d D 8.2 95/03/10 11:43:48 mckusick 17 16
c fix up synopsis
e
s 00002/00002/00185
d D 8.1 93/06/04 13:18:40 bostic 16 15
c 4.4BSD snapshot (revision 8.1); add 1993 to copyright
e
s 00008/00005/00179
d D 6.13 91/07/23 14:21:23 cael 15 14
c .Os changes, miscellaneous cleanups
e
s 00125/00120/00059
d D 6.12 91/03/10 23:39:47 cael 14 13
c man page macro and text revisions (-mdoc version 3)
e
s 00001/00011/00178
d D 6.11 90/06/23 17:48:46 trent 13 12
c new copyright notice
e
s 00123/00104/00066
d D 6.10 90/05/06 14:33:27 mckusick 12 11
c new quota system
e
s 00010/00005/00160
d D 6.9 88/07/09 11:41:34 bostic 11 10
c install approved copyright notice
e
s 00008/00002/00157
d D 6.8 88/05/20 12:21:56 bostic 10 9
c add Berkeley specific header
e
s 00001/00001/00158
d D 6.7 86/05/15 15:48:41 anne 9 8
c spelling
e
s 00001/00001/00158
d D 6.6 86/03/04 18:35:33 donn 8 7
c Change caddr_t to char * -- caddr_t shouldn't appear outside the kernel.
e
s 00004/00004/00155
d D 6.5 85/06/28 17:25:06 sechrest 7 6
c Improved english
e
s 00003/00000/00156
d D 6.4 85/06/06 03:04:11 lepreau 6 4
c DOWARN can reset warning count
e
s 00003/00002/00154
d R 6.4 85/06/06 02:21:53 lepreau 5 4
c DOWARN can reset the warning count
e
s 00007/00006/00149
d D 6.3 85/05/24 16:37:08 mckusick 4 3
c correct the description of Q_SYNC
e
s 00008/00010/00147
d D 6.2 85/05/24 15:24:31 mckusick 3 2
c returns EINVAL if quotas are not compiled;
c return ESRCH in all cases where system does not have a quota for the user;
c return ENODEV instead of EINVAL if the device is not a mounted file system
e
s 00001/00001/00156
d D 6.1 85/05/15 11:57:47 mckusick 2 1
c 4.3BSD beta release manual page
e
s 00157/00000/00000
d D 5.1 85/05/15 11:57:40 mckusick 1 0
c manual page first distributed with 4.2BSD
e
u
U
t
T
I 1
D 12
.\" Copyright (c) 1983 Regents of the University of California.
E 12
I 12
D 14
.\" Copyright (c) 1983, 1990 Regents of the University of California.
E 14
I 14
D 16
.\" Copyright (c) 1983, 1990, 1991 Regents of the University of California.
E 14
E 12
D 10
.\" All rights reserved.  The Berkeley software License Agreement
.\" specifies the terms and conditions for redistribution.
E 10
I 10
.\" All rights reserved.
E 16
I 16
.\" Copyright (c) 1983, 1990, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
E 16
.\"
I 12
.\" This code is derived from software contributed to Berkeley by
.\" Robert Elz at The University of Melbourne.
D 14
.\"
E 14
E 12
D 13
.\" Redistribution and use in source and binary forms are permitted
D 11
.\" provided that this notice is preserved and that due credit is given
.\" to the University of California at Berkeley. The name of the University
.\" may not be used to endorse or promote products derived from this
.\" software without specific prior written permission. This software
.\" is provided ``as is'' without express or implied warranty.
E 11
I 11
.\" provided that the above copyright notice and this paragraph are
.\" duplicated in all such forms and that any documentation,
.\" advertising materials, and other materials related to such
.\" distribution and use acknowledge that the software was developed
.\" by the University of California, Berkeley.  The name of the
.\" University may not be used to endorse or promote products derived
.\" from this software without specific prior written permission.
.\" THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED
.\" WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR A PARTICULAR PURPOSE.
E 13
I 13
D 15
.\" %sccs.include.redist.man%
E 15
E 13
E 11
E 10
.\"
D 14
.\"	%W% (Berkeley) %G%
E 14
I 14
D 15
.\"     %W% (Berkeley) %G%
E 15
I 15
.\" %sccs.include.redist.roff%
E 15
E 14
.\"
I 15
.\"	%W% (Berkeley) %G%
.\"
E 15
D 2
.TH QUOTA 2 "7 July 1983"
E 2
I 2
D 12
.TH QUOTA 2 "%Q%"
E 2
.UC 5
E 12
I 12
D 14
.TH QUOTACTL 2 "%Q%"
.UC 7
E 12
.SH NAME
D 12
quota \- manipulate disk quotas
E 12
I 12
quotactl \- manipulate disk quotas
E 12
.SH SYNOPSIS
D 12
.nf
.B #include <sys/quota.h>
E 12
I 12
.BI "#include <ufs/quota.h>" "	/* for ``ufs'' quotas */"
E 12
.PP
D 12
.B quota(cmd, uid, arg, addr)
.B int cmd, uid, arg;
E 12
I 12
.nf
.B quotactl(path, cmd, id, addr)
.B char *path;
.B int cmd, id;
E 12
D 8
.B caddr_t addr;
E 8
I 8
.B char *addr;
E 8
.fi
.SH DESCRIPTION
E 14
I 14
.Dd %Q%
.Dt QUOTACTL 2
D 15
.Os BSD 4.4
E 15
I 15
.Os
E 15
.Sh NAME
.Nm quotactl
.Nd manipulate filesystem quotas
.Sh SYNOPSIS
D 17
.Ft #include <ufs/quota.h>	/* for ufs quotas */
E 17
I 17
.Fd #include <ufs/quota.h>	/* for ufs quotas */
E 17
.Ft int
.Fn quotactl "const char *path" "int cmd" "int id" "char *addr"
.Sh DESCRIPTION
E 14
The
D 12
.I quota
call manipulates disk quotas for file systems
D 7
which have had quotas enabled with
E 7
I 7
that have had quotas enabled with
E 7
.IR setquota (2).
E 12
I 12
D 14
.I quotactl
call is used to enable and disable quotas and
to manipulate disk quotas for filesystems on
which quotas have been enabled.
.I Path
is the path name of any file within the mounted filesystem
to which the quota control command is to be applied.
E 12
The
.I cmd
D 12
parameter indicates a command to be applied to
the user ID
.IR uid .
.I Arg
is a command specific argument and
.I addr
E 12
I 12
parameter indicates a command to be applied to the
.IR id .
.I Addr
E 12
is the address of an optional, command specific, data structure
D 7
which is copied in or out of the system.  The interpretation of
E 7
I 7
that is copied in or out of the system.  The interpretation of
E 7
D 12
.I arg
and
E 12
.I addr
D 12
is given with each command below.
E 12
I 12
is given with each command.
.PP
E 14
I 14
.Fn quotactl
call enables, disables and
manipulates filesystem quotas.
A quota control command
given by
.Fa cmd
operates on the given filename
.Fa path
for the given user
.Fa id .
The address of an optional command specific data structure,
.Fa addr ,
may be given; its interpretation
is discussed below with each command.
.Pp
E 14
Currently quotas are supported only for the ``ufs'' filesystem.
For ``ufs'',
a command is composed of a primary command (see below)
D 14
and a command type that is used to interpret the
.IR id .
E 14
I 14
and a command type used to interpret the
.Fa id .
E 14
Types are supported for interpretation of user identifiers
and group identifiers.
The ``ufs'' specific commands are:
E 12
D 14
.TP
D 12
Q_SETDLIM
Set disc quota limits and current usage for the user with ID
.IR uid .
.I Arg
is a major-minor device indicating a particular file system.
E 12
I 12
Q_QUOTAON
E 14
I 14
.Bl -tag -width Q_QUOTAON
.It Dv Q_QUOTAON
E 14
Enable disk quotas for the filesystem specified by
D 14
.IR path .
E 14
I 14
.Fa path .
E 14
The command type specifies the type of the quotas being enabled.
The
D 14
.I addr
E 14
I 14
.Fa addr
E 14
argument specifies a file from which to take the quotas.
The quota file must exist;
it is normally created with the 
D 14
.IR quotacheck (8)
E 14
I 14
.Xr quotacheck 8
E 14
program.
The
D 14
.I id
E 14
I 14
.Fa id
E 14
argument is unused.
Only the super-user may turn quotas on.
D 14
.TP
Q_QUOTAOFF
E 14
I 14
.It Dv Q_QUOTAOFF
E 14
Disable disk quotas for the filesystem specified by
D 14
.I path .
E 14
I 14
.Fa path .
E 14
The command type specifies the type of the quotas being disabled.
The
D 14
.I addr
E 14
I 14
.Fa addr
E 14
and
D 14
.I id
E 14
I 14
.Fa id
E 14
arguments are unused.
Only the super-user may turn quotas off.
D 14
.TP
Q_GETQUOTA
E 14
I 14
.It Dv Q_GETQUOTA
E 14
Get disk quota limits and current usage for the user or group
(as determined by the command type) with identifier
D 14
.IR id .
E 12
.I Addr
is a pointer to a struct dqblk structure (defined in 
D 12
.RI < sys/quota.h >).
This call is restricted to the super-user.
E 12
I 12
.RI < ufs/quota.h >).
E 12
.TP
D 12
Q_GETDLIM
Get disc quota limits and current usage for the user with ID
.IR uid .
The remaining parameters are as for Q_SETDLIM.
.TP
Q_SETDUSE
Set disc usage limits for the user with ID
.IR uid .
.I Arg
is a major-minor device indicating a particular file system.
E 12
I 12
Q_SETQUOTA
E 14
I 14
.Fa id .
.Fa Addr
is a pointer to a
.Fa struct dqblk
structure (defined in 
.Ao Pa ufs/quota.h Ac ) .
.It Dv Q_SETQUOTA
E 14
Set disk quota limits for the user or group
(as determined by the command type) with identifier
D 14
.IR id .
E 12
.I Addr
D 12
is a pointer to a struct dqusage structure (defined in
.RI < sys/quota.h >).
E 12
I 12
is a pointer to a struct dqblk structure (defined in 
.RI < ufs/quota.h >).
The usage fields of the dqblk structure are ignored.
E 14
I 14
.Fa id .
.Fa Addr
is a pointer to a
.Fa struct dqblk
structure (defined in 
.Ao Pa ufs/quota.h Ac ) .
The usage fields of the
.Fa dqblk
structure are ignored.
E 14
E 12
This call is restricted to the super-user.
D 14
.TP
D 12
Q_SYNC
Update the on-disc copy of quota usages.
D 4
The
.IR uid ,
.IR arg ,
and
.I addr 
parameters are ignored.
E 4
I 4
.I Arg
is a major-minor device indicating the file system to be sync'ed.
If the
.I arg
D 7
parameter is specified as NODEV, all file systems which have
E 7
I 7
parameter is specified as NODEV, all file systems that have
E 7
disc quotas will be sync'ed.
The \fIuid\fP and \fIaddr\fP parameters are ignored.
E 4
.TP
Q_SETUID
Change the calling process's quota limits to those of the
user with ID
.IR uid .
The 
.I arg
and
.I addr
parameters are ignored.  This call is restricted to the super-user.
.TP
Q_SETWARN
Alter the disc usage warning limits for the user with ID
.IR uid .
.I Arg
is a major-minor device indicating a particular file system.
E 12
I 12
Q_SETUSE
E 14
I 14
.It Dv Q_SETUSE
E 14
Set disk usage limits for the user or group
(as determined by the command type) with identifier
D 14
.IR id .
E 12
.I Addr
D 12
is a pointer to a struct dqwarn structure (defined in
.RI < sys/quota.h >).
E 12
I 12
is a pointer to a struct dqblk structure (defined in
.RI < ufs/quota.h >).
E 14
I 14
.Fa id .
.Fa Addr
is a pointer to a
.Fa struct dqblk
structure (defined in
.Ao Pa ufs/quota.h Ac ) .
E 14
Only the usage fields are used.
E 12
This call is restricted to the super-user.
D 14
.TP
D 12
Q_DOWARN
Warn the user with user ID
.I uid
about excessive disc usage.
This call causes the system to check its current disc usage
information and print a message on the terminal of
the caller for each file system on which the user is over quota.
I 6
If the user is under quota, his warning count is reset to MAX_*_WARN
(defined in
.RI < sys/quota.h >).
E 6
If the
.I arg
D 7
parameter is specified as NODEV, all file systems which have
E 7
I 7
parameter is specified as NODEV, all file systems that have
E 7
disc quotas will be checked.  Otherwise, 
.I arg
indicates a specific major-minor device to be checked.
This call is restricted to the super-user.
E 12
I 12
Q_SYNC
E 14
I 14
.It Dv Q_SYNC
E 14
Update the on-disk copy of quota usages.
The command type specifies which type of quotas are to be updated.
D 14
The \fIid\fP and \fIaddr\fP parameters are ignored.
E 12
.SH "RETURN VALUE"
E 14
I 14
The
.Fa id
and
.Fa addr
parameters are ignored.
.El
.Sh RETURN VALUES
E 14
D 3
A successful call returns 0 and, possibly, more
information specific to the 
.I cmd
performed; when an error occurs, the value \-1
is returned and 
E 3
I 3
A successful call returns 0,
D 14
otherwise the value \-1 is returned and the global variable
E 3
.I errno
E 14
I 14
otherwise the value -1 is returned and the global variable
.Va errno
E 14
D 3
is set to indicate the reason.
E 3
I 3
indicates the reason for the failure.
E 3
D 14
.SH ERRORS
D 3
A
.I quota
call will fail when one of the following occurs:
E 3
I 3
D 12
A \fIquota\fP call will fail when one of the following occurs:
E 12
I 12
A \fIquotactl\fP call will fail when one of the following occurs:
E 12
E 3
.TP 15
D 12
[EINVAL]
E 12
I 12
[EOPNOTSUPP]
E 12
I 3
The kernel has not been compiled with the QUOTA option.
.TP 15
I 12
[EUSERS]
E 14
I 14
.Sh ERRORS
A
.Fn quotactl
call will fail if:
.Bl -tag -width ENAMETOOLONGAA
.It Bq Er EOPNOTSUPP
The kernel has not been compiled with the
.Dv QUOTA
option.
.It Bq Er EUSERS
E 14
The quota table cannot be expanded.
D 14
.TP 15
E 12
[EINVAL]
E 3
.I Cmd
E 14
I 14
.It Bq Er EINVAL
.Fa Cmd
E 14
D 12
is invalid.
E 12
I 12
or the command type is invalid.
E 12
D 14
.TP 15
D 12
[ESRCH]
No disc quota is found for the indicated user.
E 12
I 12
[EINVAL]
E 14
I 14
.It Bq Er EINVAL
E 14
A pathname contains a character with the high-order bit set.
E 12
D 14
.TP 15
D 12
[EPERM]
The call is priviledged and the caller was not the super-user.
E 12
I 12
[EACCES]
In Q_QUOTAON, the quota file is not a plain file.
E 12
.TP 15
D 3
[EINVAL]
E 3
I 3
D 12
[ENODEV]
E 3
The 
.I arg
parameter is being interpreted as a major-minor
device and it indicates an unmounted file system.
E 12
I 12
[EACCES]
E 14
I 14
.It Bq Er EACCES
In
.Dv Q_QUOTAON ,
the quota file is not a plain file.
.It Bq Er EACCES
E 14
Search permission is denied for a component of a path prefix.
E 12
D 14
.TP 15
I 12
[ENOTDIR]
A component of a path prefix is not a directory.
.TP 15
[ENAMETOOLONG]
E 14
I 14
.It Bq Er ENOTDIR
A component of a path prefix was not a directory.
.It Bq Er ENAMETOOLONG
E 14
A component of either pathname exceeded 255 characters,
or the entire length of either path name exceeded 1023 characters.
D 14
.TP 15
[ENOENT]
E 14
I 14
.It Bq Er ENOENT
E 14
A filename does not exist.
D 14
.TP 15
[ELOOP]
E 14
I 14
.It Bq Er ELOOP
E 14
Too many symbolic links were encountered in translating a pathname.
D 14
.TP 15
[EROFS]
In Q_QUOTAON, the quota file resides on a read-only filesystem.
.TP 15
[EIO]
E 14
I 14
.It Bq Er EROFS
In
.Dv Q_QUOTAON ,
the quota file resides on a read-only filesystem.
.It Bq Er EIO
E 14
D 15
An I/O error occurred while reading from or writing
E 15
I 15
An
.Tn I/O
error occurred while reading from or writing
E 15
to a file containing quotas.
D 14
.TP 15
E 12
[EFAULT]
E 14
I 14
.It Bq Er EFAULT
E 14
An invalid
D 14
.I addr
is supplied; the associated structure could not be copied in or out
E 14
I 14
.Fa addr
was supplied; the associated structure could not be copied in or out
E 14
of the kernel.
D 14
.TP 15
D 12
[EUSERS]
The quota table is full.
E 12
I 12
[EFAULT]
.I Path
E 14
I 14
.It Bq Er EFAULT
.Fa Path
E 14
points outside the process's allocated address space.
D 14
.TP 15
[EPERM]
The call is privileged and the caller was not the super-user.
E 12
.SH "SEE ALSO"
D 12
setquota(2), quotaon(8), quotacheck(8)
E 12
I 12
quota(1),
fstab(5),
edquota(8), quotacheck(8), quotaon(8), repquota(8)
E 12
.SH BUGS
E 14
I 14
.It Bq Er EPERM
The call was privileged and the caller was not the super-user.
.El
.Sh SEE ALSO
.Xr quota 1 ,
.Xr fstab 5 ,
.Xr edquota 8 ,
.Xr quotacheck 8 ,
.Xr quotaon 8 ,
.Xr repquota 8
.Sh BUGS
E 14
D 9
There should be someway to integrate this call with the resource
E 9
I 9
There should be some way to integrate this call with the resource
E 9
limit interface provided by
D 14
.IR setrlimit (2)
E 14
I 14
.Xr setrlimit 2
E 14
and
D 14
.IR getrlimit (2).
E 14
I 14
.Xr getrlimit 2 .
.Sh HISTORY
The
D 15
.Nm
E 15
I 15
.Nm quotactl
E 15
function call appeared in
.Bx 4.3 Reno .
E 14
D 12
.PP
The Australian spelling of
.I disk
is used throughout the quota facilities in honor of
the implementors.
E 12
E 1
